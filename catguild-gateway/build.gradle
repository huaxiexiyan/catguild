plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.2'
    id 'com.google.cloud.tools.jib'
}

sourceCompatibility = JavaVersion.VERSION_17
targetCompatibility = JavaVersion.VERSION_17

dependencies {
    //cloud组件
    implementation 'org.springframework.cloud:spring-cloud-starter-gateway'
    implementation 'org.springframework.cloud:spring-cloud-starter-openfeign'
    implementation 'org.springframework.cloud:spring-cloud-starter-loadbalancer'
    // 服务注册与发现
    implementation 'org.springframework.cloud:spring-cloud-starter-bootstrap'
    implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-config'
    implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery'
}

jib.to.image = "huaxiexiyan/catguild-gateway"

jib {
    from {
        image = 'aws_account_id.dkr.ecr.region.amazonaws.com/my-base-image'
        credHelper = 'ecr-login'
    }
    to {
        image = 'gcr.io/my-gcp-project/my-app'
        credHelper = 'gcr'
    }
    container {
        jvmFlags = ['-Dmy.property=example.value', '-Xms512m', '-Xdebug']
        mainClass = 'mypackage.GatewayApp'
        args = ['some', 'args']
        ports = ['1000', '2000-2003/udp']
        format = 'OCI'
    }
}
